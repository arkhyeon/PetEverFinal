<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="statis">

	<insert id="insertXml">
		insert into shelterAnimal
		values(
			#{ desertionNo }, #{ fileName }, to_date(#{ happenDt }, 'yyyymmdd'), #{ happenPlace }, #{ kindCd },
			#{ colorCd }, #{ age }, #{ weight }, #{ noticeNo }, to_date(#{ noticeSdt }, 'yyyymmdd'),
			to_date(#{ noticeEdt }, 'yyyymmdd'), #{ popfile }, #{ processState }, #{ genderCd }, #{ neuterYn },
			#{ SpecialMark }, #{ careNm }, #{ careTel }, #{ careAddr }, #{ orgNm },
			#{ chargeNm }, #{ officetel }
		)
	</insert>

	<select id="countStatisSearch" resultMap="statisList">
		select count(*),process_state from shelterAnimal where notice_no like #{ city } and 
		(happen_dt <![CDATA[ >=  ]]> #{startDay} and happen_dt <![CDATA[ <=  ]]>  #{endDay}) group by process_state having process_state not like '%미포획%'
		order by process_state
	</select>

	<select id="euthanasia" resultType="list">
		select 
		<foreach collection="areaArr" item="item" open="count(case when org_nm like'" close="' then 1 end)" separator="' then 1 end), count(case when org_nm like'">
		    #{item}
		   
		</foreach>
		from shelterAnimal
		where process_state like '%안락사%' or process_state like '%자연사%';
	</select>

	<select id="adoptStatis" resultType="_int">
		select count(*) from shelterAnimal where notice_no like #{ area } and (process_state like '%입양%'  or process_state like '%보호%')
	</select>
	<select id="selectList" resultMap="statisList">
		select count(*),process_state from shelterAnimal group by process_state having process_state not like '%미포획%'
		order by process_state
	</select>
	
	<resultMap id="statisList" type="StatisList">
		<id column="count(*)" property="cnt"></id>
		<result column="process_state" property="state" jdbcType="VARCHAR" javaType="java.lang.String"></result>
	</resultMap>
</mapper>